<!doctype html>
<html lang="en" class="bg-gray-100">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ServisBOT — Fallback Status Page</title>

    <!-- Tailwind Play CDN (no build required) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- DaisyUI precompiled CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui/dist/full.css" rel="stylesheet">

    <style>
        /* small tweaks on top of Tailwind/DaisyUI */
        body {
            background: #f4f6fb;
            margin: 0;
            padding: 0;
        }

        .app-container {
            max-width: 980px;
            margin: 2.5rem auto;
            padding: 0 1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 9999px;
            display: inline-block;
            margin-right: .5rem;
            vertical-align: middle;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen m-0">
    <div class="app-container">


        <!-- Header -->
        <div class="flex flex-col md:flex-row items-center md:items-start gap-6 md:gap-8 mb-10">
            <!-- Logo -->
            <div class="flex-shrink-0 rounded-lg bg-white shadow-md w-28 h-20 flex items-center justify-center">
                <img src="assets/logo.png" alt="ServisBOT Logo" class="h-16 object-contain">
            </div>

            <!-- Text -->
            <div class="flex-1">
                <h1 class="text-3xl font-extrabold text-slate-900 mb-2">
                    ServisBOT — Fallback Status Page
                </h1>
                <p class="text-base text-slate-600 mb-1">
                    Github hosted fallback status page. For subscription and official updates, visit the main status
                    page.
                </p>
                <p class="text-sm text-slate-400">
                    <a href="https://status.servisbot.com/" target="_blank" rel="noopener"
                        class="link underline hover:text-slate-700">
                        Primary status page
                    </a>
                </p>
            </div>
        </div>




        <!-- Dynamic banner -->
        <div id="banner" class="hidden p-4 rounded-lg mb-6 shadow-md">
            <div id="bannerText" class="text-base font-semibold"></div>
        </div>


        <!-- Regions grid -->
        <div id="regions" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>

        <!-- Timeline -->
        <div id="timelineContainer" class="mt-8 hidden">
            <div class="card bg-white shadow-md p-5 rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-slate-700">Timeline</h3>
                <div id="timelineList" class="space-y-3 text-sm text-slate-600 max-h-48 overflow-y-auto"></div>
            </div>
        </div>


        <!-- Footer -->
        <footer class="mt-10 text-sm text-slate-500">
            <div id="contact" class="mb-1"></div>
            <div id="timestamp"></div>
        </footer>


    </div>

    <script>
        /* ---------- same logic as your original script, adapted to Tailwind/DaisyUI DOM ---------- */

        function statusPriority(s) {
            if (!s) return 0;
            const v = String(s).toUpperCase();
            if (v === 'DOWN' || v === 'ERROR') return 3;
            if (v === 'DEGRADED') return 2;
            if (v === 'OK' || v === 'OPERATIONAL') return 1;
            return 0;
        }

        function dotClassFor(s) {
            const p = statusPriority(s);
            if (p === 3) return 'bg-red-600';
            if (p === 2) return 'bg-amber-500';
            return 'bg-emerald-600';
        }

        async function load() {
            try {
                const r = await fetch('status.json', { cache: 'no-store' });
                if (!r.ok) throw new Error('Failed to load status.json');
                const data = await r.json();
                render(data);
            } catch (e) {
                console.error(e);
                document.getElementById('regions').innerHTML = '<div class="card bg-white p-4 shadow-sm text-sm text-red-600">Unable to load status data.</div>';
            }
        }

        function render(data) {
            // banner
            const bannerEl = document.getElementById('banner');
            const bannerText = document.getElementById('bannerText');
            const overall = data.status ? String(data.status).toUpperCase() : 'UNKNOWN';
            bannerEl.className = 'hidden p-4 rounded-lg mb-6';
            if (overall === 'DOWN') {
                bannerEl.classList.add('bg-red-100', 'border', 'border-red-200', 'flex', 'items-center', 'justify-between');
                bannerText.textContent = 'Major service outage — some systems are down.';
                bannerText.className = 'text-red-800 font-semibold';
                bannerEl.classList.remove('hidden');
            } else if (overall === 'DEGRADED') {
                bannerEl.classList.add('bg-amber-50', 'border', 'border-amber-100', 'flex', 'items-center', 'justify-between');
                bannerText.textContent = 'Some systems are experiencing degraded performance.';
                bannerText.className = 'text-amber-800 font-semibold';
                bannerEl.classList.remove('hidden');
            } else {
                bannerEl.classList.add('bg-emerald-50', 'border', 'border-emerald-100', 'flex', 'items-center', 'justify-between');
                bannerText.textContent = 'All Systems Operational';
                bannerText.className = 'text-emerald-800 font-semibold';
                bannerEl.classList.remove('hidden');
            }

            // regions
            const regionsEl = document.getElementById('regions');
            regionsEl.innerHTML = '';
            const regions = data.affected_regions || [];
            for (const reg of regions) {
                const card = document.createElement('div');
                card.className = 'card bg-white shadow-md p-4 rounded-lg flex flex-col hover:shadow-lg transition-shadow duration-200';


                // header row
                const headerRow = document.createElement('div');
                headerRow.className = 'flex items-center justify-between mb-3';
                const regionTitle = document.createElement('div');
                regionTitle.innerHTML = `<div class="text-sm font-medium">${reg.region_name}</div><div class="text-xs text-slate-400">${(reg.services && reg.services.length) ? reg.services.length + ' services' : ''}</div>`;
                headerRow.appendChild(regionTitle);

                // compute region worst status
                let regionWorst = 'OK';
                for (const s of (reg.services || [])) {
                    const st = (s.status || '').toUpperCase();
                    if (st === 'DOWN') { regionWorst = 'DOWN'; break; }
                    if (st === 'DEGRADED' && regionWorst !== 'DEGRADED') regionWorst = 'DEGRADED';
                }
                const badge = document.createElement('div');
                badge.className = 'badge';
                if (regionWorst === 'DOWN') badge.classList.add('badge-error');
                else if (regionWorst === 'DEGRADED') badge.classList.add('badge-warning');
                else badge.classList.add('badge-success');
                badge.textContent = regionWorst;
                headerRow.appendChild(badge);

                card.appendChild(headerRow);

                // services list
                const list = document.createElement('div');
                list.className = 'flex-1';
                for (const svc of (reg.services || [])) {
                    const row = document.createElement('div');
                    row.className = 'flex items-center justify-between py-2 border-b last:border-b-0';
                    const left = document.createElement('div');
                    const dot = document.createElement('span');
                    dot.className = 'status-dot ' + dotClassFor(svc.status);
                    left.appendChild(dot);
                    const name = document.createElement('span');
                    name.className = 'text-sm font-medium';
                    name.textContent = svc.name;
                    left.appendChild(name);

                    const right = document.createElement('div');
                    right.innerHTML = `<div class="text-sm font-semibold">${(svc.status || 'UNKNOWN')}</div><div class="text-xs text-slate-400">${svc.checkUrl ? svc.checkUrl : ''}</div>`;

                    row.appendChild(left);
                    row.appendChild(right);
                    list.appendChild(row);
                }
                card.appendChild(list);

                regionsEl.appendChild(card);
            }

            // timeline
            const tl = document.getElementById('timelineContainer');
            const tlList = document.getElementById('timelineList');
            if (Array.isArray(data.timeline) && data.timeline.length) {
                tlList.innerHTML = data.timeline.slice().reverse().map(e => `<div><div class="text-xs text-slate-500">${new Date(e.time).toLocaleString()}</div><div class="text-sm">${e.status}</div></div>`).join('');
                tl.classList.remove('hidden');
            } else {
                tl.classList.add('hidden');
            }

            // contact + timestamp
            document.getElementById('contact').innerHTML = 'Contact: <a class="link" href="mailto:' + (data.contact || '') + '">' + (data.contact || '') + '</a>';
            document.getElementById('timestamp').textContent = 'Page timestamp: ' + (data.timestamp ? new Date(data.timestamp).toLocaleString() : '—');
        }

        // initial load + refresh
        load();
        setInterval(load, 60 * 1000);
    </script>
</body>

</html>